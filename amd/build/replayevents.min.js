define ("logstore_xapi/replayevents",["core/str","core/config","core/notification","core/templates","jquery","jqueryui"],function(a,b,c,d,f){var e=0,g=!1,h="resendevents",i="confirmresendeventsheader",j="confirmresendevents",k="",l="",m="",n="",o={CHECKBOXES:"#xapierrorlog_form .form-check-input",CHECKBOX_DATEFROM:"#xapierrorlog_form #id_datefrom_enabled",CHECKBOX_DATETO:"#xapierrorlog_form #id_dateto_enabled",FORM:"#xapierrorlog_form .mform",PAGE_LINKS:".pagination .page-item .page-link",REPLAY_EVENTS:"#xapierrorlog_data .reply-event",SELECTS:"#xapierrorlog_form .custom-select",SELECT_ERRORTYPE:"#xapierrorlog_form #id_errortype",SELECT_EVENTNAME:"#xapierrorlog_form #id_eventname",SELECT_RESPONSE:"#xapierrorlog_form #id_response",SELECT_DATAFROM:"#xapierrorlog_form #id_datefrom .custom-select",SELECT_DATATO:"#xapierrorlog_form #id_dateto .custom-select",SEND_BUTTON:"#xapierrorlog_form #id_resendselected",SEND_CAN_DO:"#xapierrorlog_form input[name^=\"resend\"]",SEND_ID:"#xapierrorlog_form input[name^=\"id\"]",SUBMIT_FORM:"#xapierrorlog_form #id_submitbutton"},p="reply-event-id-";return{init:function init(a){e=a;if(1==f(o.SEND_ID).val()){i="confirmsendeventsheader";j="confirmsendevents";h="sendevents"}this.registerOnChangeSelectEvents();this.updateResend();this.registerResendEvent();this.addReplyEvents()},addReplyEvents:function addReplyEvents(){if(0==f(o.REPLAY_EVENTS).length){return}this.generateLoadHTML();this.generateDoneHTML();this.generateFailedHTML();this.generateReplayHTML();this.registerReplyEventListeners()},registerReplyEventListeners:function registerReplyEventListeners(){var a=this;f(o.REPLAY_EVENTS).click(function(b){b.stopPropagation();b.preventDefault();a.disableFormControls();a.disablePagination();var c=f(this);c.off("click");c.addClass("disabled");var d=c.attr("id"),e=d.replace(p,"");a.doReplayEvent(e)})},doReplayEvent:function doReplayEvent(a){var d=b.wwwroot+"/admin/tool/log/store/xapi/ajax/moveback_to_log.php",g=this,h=f("#"+p+a),i=f(o.SEND_ID).val();h.empty();h.append(k);h.removeClass("reply-event");f.ajax({type:"POST",url:d,data:{events:[a],historical:i,sesskey:M.cfg.sesskey},success:function success(a){h.empty();if(a.success){h.append(m);e--;g.updateResend()}else{h.append(n)}g.enableFormControls();g.enablePagination()},fail:function fail(a){c.exception(a);h.empty();h.append(n);g.enableFormControls();g.enablePagination()}})},registerOnChangeSelectEvents:function registerOnChangeSelectEvents(){var a=this;f(o.SELECTS).change(function(){g=!0;a.disableResend()})},registerResendEvent:function registerResendEvent(){var b=this;if(g){return}f(o.SEND_BUTTON).click(function(){b.disableFormControls();b.disablePagination();a.get_strings([{key:i,component:"logstore_xapi"},{key:j,component:"logstore_xapi",param:{count:e}},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(a){c.confirm(a[0],a[1],a[2],a[3],function(){f(o.SEND_CAN_DO).val(1);f(o.FORM).submit()},function(){b.enableFormControls();b.enablePagination()})})})},updateResend:function updateResend(){var b=f(o.SEND_BUTTON),c=this;a.get_strings([{key:h,component:"logstore_xapi",param:{count:e}}]).done(function(a){b.attr("Value",e);b.html(a);if(0!=e&&!1===g){c.enableResend()}})},disableElements:function disableElements(a){a.addClass("disabled");a.attr("disabled","disabled");a.prop("disabled",!0)},enableElements:function enableElements(a){a.removeClass("disabled");a.prop("disabled",!1);a.removeAttr("disabled")},disablePagination:function disablePagination(){if(0==f(o.PAGE_LINKS).length){return}var a=f(o.PAGE_LINKS);this.disableElements(a);a.bind("click",function(a){a.preventDefault()})},enablePagination:function enablePagination(){if(0==f(o.PAGE_LINKS).length){return}var a=f(o.PAGE_LINKS);this.enableElements(a);a.unbind("click")},disableResend:function disableResend(){this.disableElements(f(o.SEND_BUTTON))},enableResend:function enableResend(){this.enableElements(f(o.SEND_BUTTON))},disableReplyEvents:function disableReplyEvents(){f(o.REPLAY_EVENTS).off("click");this.disableElements(f(o.REPLAY_EVENTS))},enableReplyEvents:function enableReplyEvents(){this.enableElements(f(o.REPLAY_EVENTS));this.registerReplyEventListeners()},disableFormSubmit:function disableFormSubmit(){this.disableElements(f(o.SUBMIT_FORM))},enableFormSubmit:function enableFormSubmit(){this.enableElements(f(o.SUBMIT_FORM))},disableFormSelects:function disableFormSelects(){this.disableElements(f(o.SELECTS))},enableFormSelects:function enableFormSelects(){this.enableElements(f(o.SELECT_ERRORTYPE));this.enableElements(f(o.SELECT_EVENTNAME));this.enableElements(f(o.SELECT_RESPONSE));if(f(o.CHECKBOX_DATEFROM).is(":checked")){this.enableElements(f(o.SELECT_DATAFROM))}if(f(o.CHECKBOX_DATETO).is(":checked")){this.enableElements(f(o.SELECT_DATATO))}},disableFormCheckboxes:function disableFormCheckboxes(){this.disableElements(f(o.CHECKBOXES))},enableFormCheckboxes:function enableFormCheckboxes(){this.enableElements(f(o.CHECKBOXES))},disableFormControls:function disableFormControls(){this.disableFormSubmit();this.disableFormCheckboxes();this.disableFormSelects();this.disableResend()},enableFormControls:function enableFormControls(){this.enableFormCheckboxes();this.enableFormSelects();this.enableFormSubmit();this.enableResend()},generateLoadHTML:function generateLoadHTML(){a.get_strings([{key:"loadinghelp",component:"moodle"}]).done(function(a){k="<span aria-hidden=\"true\" class=\"fa fa-spinner fa-spin fa-pulse\" title=\""+a+"\"></span><span class=\"sr-only\">"+a+"</span>"})},generateDoneHTML:function generateDoneHTML(){a.get_strings([{key:"success",component:"moodle"}]).done(function(a){m="<span aria-hidden=\"true\" class=\"fa fa-check\" title=\""+a+"\"></span><span class=\"sr-only\">"+a+"</span>"})},generateFailedHTML:function generateFailedHTML(){a.get_strings([{key:"failed",component:"logstore_xapi"}]).done(function(a){n="<span aria-hidden=\"true\" class=\"fa fa-remove\" title=\""+a+"\"></span><span class=\"sr-only\">"+a+"</span>"})},generateReplayHTML:function generateReplayHTML(){a.get_strings([{key:"replayevent",component:"logstore_xapi"}]).done(function(a){l="<span aria-hidden=\"true\" class=\"fa fa-repeat\" title=\""+a+"\"></span><span class=\"sr-only\">"+a+" </span>";f(o.REPLAY_EVENTS).append(l)})}}});
//# sourceMappingURL=replayevents.min.js.map
